# SPECYFIKACJA KOMPLETNA: STREAMLIT COVERED CALL DASHBOARD
## ZarzÄ…dzanie portfelem opcji pokrytych z rozliczeniami podatkowymi PL

**Status: 70/110 punktÃ³w ukoÅ„czone (64%)**  
**Ostatnia aktualizacja: 2025-01-26**  
**Aktualny milestone: PUNKT 70 - UkoÅ„czenie ETAPU 4 Options**

---

## ğŸ¯ OGÃ“LNY OPIS PROJEKTU

### Kontekst biznesowy
- **Broker**: Lynx (IBKR)
- **Dane**: RÄ™czne wprowadzanie w Streamlit (brak importÃ³w)
- **Konto**: Jedno w USD
- **Rozliczenia**: KaÅ¼da operacja przeliczana na PLN wg kursu NBP D-1; kurs i kwota PLN utrwalone w bazie

### Rozliczenia podatkowe
- **PIT-38**: akcje, opcje CC, prowizje, odsetki od margin, odsetki od gotÃ³wki, stock lending
- **PIT-36**: dywidendy (15% WHT + 4% dopÅ‚ata)
- **Uwaga**: Przewalutowania walut na rachunku nie sÄ… ksiÄ™gowane do PIT

### ModuÅ‚y aplikacji (9 kart w Streamlit)
1. **Dashboard**: KPI, equity (USD, MTM), yieldy, alerty
2. **Stocks**: zakupy w LOT-ach, sprzedaÅ¼e FIFO, blokady pod CC
3. **Options (CC)**: sprzedaÅ¼, buyback, expiry, rolowanie, rezerwacje FIFO
4. **CC Chains**: Å‚aÅ„cuchy opcyjne, tracking strategii, analytics ğŸ†•
5. **Dividends**: brutto USD â†’ PLN, WHT 15%, dopÅ‚ata 4%, netto
6. **Cashflows**: peÅ‚ny dziennik wszystkich przepÅ‚ywÃ³w pieniÄ™Å¼nych
7. **Taxes**: rozbicia PIT-38/PIT-36, eksporty CSV
8. **Stats**: yieldy CC/dividend, P/L per ticker i caÅ‚oÅ›ciowo
9. **Charts**: equity curve, cashflow, pie charts, histogramy P/L

---

## ğŸ—ï¸ ETAP 1: FUNDAMENT APLIKACJI (punkty 1-15) âœ… UKOÅƒCZONY

### Punkty 1-5: Struktura podstawowa âœ…
1. âœ… Utworzenie struktury katalogÃ³w (app.py, db.py, structure.py, utils/, pages/)
2. âœ… Inicjalizacja gÅ‚Ã³wnej aplikacji Streamlit z pustÄ… strukturÄ… nawigacji
3. âœ… Konfiguracja poÅ‚Ä…czenia z bazÄ… SQLite (portfolio.db)
4. âœ… Utworzenie podstawowego layout'u aplikacji z sidebar navigation
5. âœ… Testowanie uruchomienia aplikacji (streamlit run app.py)

### Punkty 6-10: Baza danych i modele âœ…
6. âœ… Implementacja tabeli fx_rates (struktura + podstawowe operacje CRUD)
7. âœ… Implementacja tabeli cashflows (struktura + podstawowe operacje CRUD) 
8. âœ… Implementacja tabeli lots (struktura + podstawowe operacje CRUD)
9. âœ… Implementacja tabeli stock_trades i stock_trade_splits
10. âœ… Implementacja pozostaÅ‚ych tabel (options_cc, dividends, market_prices)

### Punkty 11-15: Utilities podstawowe âœ…
11. âœ… Implementacja utils/formatting.py (formatowanie liczb, walut, dat)
12. âœ… Implementacja pobierania kursÃ³w NBP z obsÅ‚ugÄ… weekendÃ³w/Å›wiÄ…t
13. âœ… Implementacja cache'owania kursÃ³w NBP w bazie
14. âœ… Testowanie pobierania i zapisywania kursÃ³w NBP
15. âœ… Seed database - utworzenie testowych kursÃ³w NBP na ostatnie 30 dni

**Status ETAP 1**: âœ… **KOMPLETNY** - Fundament aplikacji gotowy

---

## ğŸ’¸ ETAP 2: MODUÅ CASHFLOWS (punkty 16-30) âœ… UKOÅƒCZONY

### Punkty 16-20: Cashflows - struktura i logika âœ…
16. âœ… Utworzenie pages/cashflows.py z podstawowÄ… strukturÄ…
17. âœ… Implementacja formularza dodawania cashflow (wpÅ‚aty/wypÅ‚aty)
18. âœ… Implementacja automatycznego pobierania kursu NBP D-1 w formularzu
19. âœ… Implementacja zapisu cashflow z utrwaleniem fx_rate i amount_pln
20. âœ… Testowanie dodawania wpÅ‚at/wypÅ‚at z rÃ³Å¼nymi datami (wÅ‚Ä…cznie z weekendami)

### Punkty 21-25: Cashflows - UI i funkcjonalnoÅ›ci âœ…
21. âœ… Implementacja tabeli wyÅ›wietlajÄ…cej wszystkie cashflows
22. âœ… Dodanie filtrÃ³w (typ operacji, zakres dat, kwoty)
23. âœ… Implementacja edycji i usuwania cashflows
24. âœ… Dodanie walidacji (ujemne wypÅ‚aty, dodatnie wpÅ‚aty)
25. âœ… Implementacja moÅ¼liwoÅ›ci rÄ™cznej korekty kursu przed zapisem

### Punkty 26-30: Cashflows - finalizacja âœ…
26. âœ… Dodanie kolumny z linkami do operacji ÅºrÃ³dÅ‚owych (ref_table, ref_id)
27. âœ… Implementacja eksportu do CSV
28. âœ… Dodanie statystyk cashflow (suma wpÅ‚at, wypÅ‚at, saldo)
29. âœ… Testowanie peÅ‚nej funkcjonalnoÅ›ci moduÅ‚u cashflows
30. âœ… Dokumentacja i refaktoryzacja kodu cashflows

**Status ETAP 2**: âœ… **KOMPLETNY** - ModuÅ‚ Cashflows z filtrami, edycjÄ…, eksportem CSV

---

## ğŸ“Š ETAP 3: MODUÅ STOCKS (punkty 31-50) âœ… UKOÅƒCZONY

### Punkty 31-35: Stocks - zakupy (LOT-y) âœ…
31. âœ… Utworzenie pages/stocks.py z podstawowÄ… strukturÄ…
32. âœ… Implementacja formularza dodawania LOT-a (ticker, quantity, price, date)
33. âœ… Automatyczne pobieranie kursu NBP D-1 i wyliczanie cost_pln
34. âœ… Implementacja zapisu LOT-a z prowizjami (broker_fee, reg_fee)
35. âœ… Dodanie automatycznego tworzenia cashflow przy zakupie akcji

### Punkty 36-40: Stocks - logika FIFO âœ…
36. âœ… Implementacja algorytmu FIFO (sortowanie po buy_date, potem po id)
37. âœ… Implementacja funkcji sprawdzajÄ…cej dostÄ™pne quantity_open dla tickera
38. âœ… Implementacja podglÄ…du alokacji FIFO przed sprzedaÅ¼Ä…
39. âœ… Testowanie FIFO na rÃ³Å¼nych scenariuszach (czÄ™Å›ciowe sprzedaÅ¼e, rÃ³Å¼ne daty)
40. âœ… Implementacja walidacji - nie moÅ¼na sprzedaÄ‡ wiÄ™cej niÅ¼ quantity_open

### Punkty 41-45: Stocks - sprzedaÅ¼e âœ…
41. âœ… Implementacja formularza sprzedaÅ¼y akcji
42. âœ… Automatyczne rozbijanie sprzedaÅ¼y na LOT-y wedÅ‚ug FIFO
43. âœ… Proporcjonalne dzielenie prowizji sprzedaÅ¼owej na LOT-y
44. âœ… Kalkulacja P/L per LOT i caÅ‚oÅ›ciowy P/L sprzedaÅ¼y
45. âœ… Implementacja zapisu stock_trades i stock_trade_splits

### Punkty 46-50: Stocks - UI i finalizacja âœ…
46. âœ… Implementacja tabeli LOT-Ã³w (quantity_open, koszt PLN, kurs, daty)
47. âœ… Implementacja tabeli sprzedaÅ¼y z rozbiciami po LOT-ach
48. âœ… Dodanie filtrÃ³w i sortowania w tabelach
49. âœ… Implementacja eksportu stocks do CSV
50. âœ… Testowanie peÅ‚nej funkcjonalnoÅ›ci moduÅ‚u stocks

**Status ETAP 3**: âœ… **KOMPLETNY** - ModuÅ‚ Stocks z LOT-ami, FIFO, tabelami, eksportami

---

## ğŸ¯ ETAP 4: MODUÅ OPTIONS - COVERED CALLS (punkty 51-70) âœ… UKOÅƒCZONY

### Punkty 51-55: Options - struktura i rezerwacje âœ…
51. âœ… Utworzenie pages/options.py z podstawowÄ… strukturÄ…
52. âœ… Implementacja logiki rezerwacji akcji FIFO dla CC
53. âœ… Implementacja sprawdzania dostÄ™pnoÅ›ci pokrycia przed zapisem CC
54. âœ… Implementacja formularza sprzedaÅ¼y CC (ticker, contracts, strike, premium, expiry)
55. âœ… Implementacja zapisu options_cc z rezerwacjÄ… quantity_open w lots

### Punkty 56-60: Options - operacje CC âœ…
56. âœ… Implementacja automatycznego tworzenia cashflow przy sprzedaÅ¼y CC
57. âœ… Implementacja formularza buyback CC
58. âœ… Implementacja oznaczania CC jako expired (close_date = expiry_date)
59. âœ… Kalkulacja P/L dla bought_back i expired CC w PLN
60. âœ… Implementacja zwalniania rezerwacji akcji przy zamkniÄ™ciu CC

### Punkty 61-65: Options - blokady i walidacje âœ…
61. âœ… Implementacja blokady sprzedaÅ¼y akcji pod otwartymi CC
62. âœ… Rozszerzenie walidacji w UI stocks z szczegÃ³Å‚owymi komunikatami
63. âœ… Dodanie przyciskÃ³w usuwania bÅ‚Ä™dnych CC (z automatycznym zwalnianiem rezerwacji)
64. âœ… Implementacja edycji parametrÃ³w CC + usuwania rekordÃ³w testowych
65. âœ… UsuniÄ™cie niepotrzebnej funkcji Roll (buyback + nowa sprzedaÅ¼ oddzielnie)

### Punkty 66-70: Options - UI i finalizacja âœ…
66. âœ… Implementacja zaawansowanych tabel otwartych CC z rozbiciami po LOT-ach
67. âœ… Implementacja tabel zamkniÄ™tych CC z P/L PLN i kursami open/close
68. âœ… Dodanie filtrÃ³w zaawansowanych (status, ticker, zakresy dat)
69. âœ… Implementacja eksportu options do CSV + narzÄ™dzia cleanup
70. âœ… Testowanie peÅ‚nej funkcjonalnoÅ›ci moduÅ‚u options + finalizacja profesjonalnego UI

**Status ETAP 4**: âœ… **KOMPLETNY** - ModuÅ‚ Options z peÅ‚nÄ… funkcjonalnoÅ›ciÄ… CC!

---

## ğŸ”— ETAP 5: MODUÅ CC CHAINS - ÅAÅƒCUCHY OPCYJNE (punkty 71-85) ğŸ†• NOWY!

### Punkty 71-75: CC Chains - struktura i logika podstawowa â³
71. â³ Utworzenie tabeli cc_chains w bazie danych (id, ticker, start_date, end_date, status)
72. â³ Dodanie chain_id do tabeli options_cc (foreign key + migracja)
73. â³ Utworzenie pages/cc_chains.py z podstawowÄ… strukturÄ… nawigacji
74. â³ Implementacja algorytmu auto-detection chains (CC w ciÄ…gu 7 dni = ten sam chain)
75. â³ Implementacja funkcji tworzenia i zarzÄ…dzania chains w db.py

### Punkty 76-80: CC Chains - analytics i kalkulacje â³
76. â³ Implementacja kalkulacji Å‚Ä…cznego P/L per chain (suma wszystkich CC)
77. â³ Wyliczanie duration chains (dni miÄ™dzy pierwszym a ostatnim CC)
78. â³ Kalkulacja annualized return per chain i success rate
79. â³ Implementacja rankingu chains (best/worst performers)
80. â³ Dodanie metryk: avg P/L per transaction, total premium captured

### Punkty 81-85: CC Chains - UI i finalizacja â³
81. â³ Tab "Active Chains" - bieÅ¼Ä…ce Å‚aÅ„cuchy z live tracking
82. â³ Tab "Chain Analytics" - historia, performance comparison, wykresy
83. â³ Tab "Chain Management" - rÄ™czne Å‚Ä…czenie/rozÅ‚Ä…czanie, edycja
84. â³ Implementacja mini-dashboardÃ³w per chain z wszystkimi metrykami
85. â³ Eksport chain analytics do CSV i testowanie peÅ‚nej funkcjonalnoÅ›ci

**Status ETAP 5**: â³ **NOWY MODUÅ** - Zaawansowana analiza strategii CC!

---

## ğŸ’° ETAP 6: MODUÅ DIVIDENDS (punkty 86-95) â³ PLANOWANY

### Punkty 86-90: Dividends - logika podstawowa â³
86. â³ Utworzenie pages/dividends.py z podstawowÄ… strukturÄ…
87. â³ Implementacja formularza dywidend (ticker, gross_usd, date_paid)
88. â³ Automatyczne wyliczanie WHT 15% i dopÅ‚aty 4%
89. â³ Implementacja zapisu dividends z wszystkimi polami PLN
90. â³ Automatyczne tworzenie cashflow typu 'dividend'

### Punkty 91-95: Dividends - UI i finalizacja â³
91. â³ Implementacja tabeli dywidend z rozbiciami (brutto, WHT, dopÅ‚ata, netto)
92. â³ Dodanie filtrÃ³w i sortowania + przyciski edycji/usuwania dywidend
93. â³ Implementacja eksportu dividends do CSV
94. â³ Integracja z moduÅ‚em taxes (kategoria PIT-36)
95. â³ Testowanie peÅ‚nej funkcjonalnoÅ›ci moduÅ‚u dividends + cleanup bÅ‚Ä™dnych rekordÃ³w

**Status ETAP 6**: â³ **PLANOWANY** - Start po ukoÅ„czeniu ETAPU 5

---

## ğŸ“‹ ETAP 7: MODUÅ TAXES - ROZLICZENIA PODATKOWE (punkty 96-105) â³ PLANOWANY

### Punkty 96-100: Taxes - logika PIT â³
96. â³ Utworzenie pages/taxes.py i utils/tax.py
97. â³ Implementacja logiki PIT-38 (przychody i koszty)
98. â³ Implementacja logiki PIT-36 (dywidendy z rozbiciami)
99. â³ Implementacja agregacji danych z wszystkich moduÅ‚Ã³w
100. â³ Kalkulacja sum dla PIT-38 (razem przychody/koszty) i PIT-36 + narzÄ™dzia administracyjne

### Punkty 101-105: Taxes - raporty i eksporty â³
101. â³ Implementacja szczegÃ³Å‚owych tabel rozbiÄ‡ PIT-38/PIT-36 + batch operations
102. â³ Implementacja eksportÃ³w CSV (PIT-38.csv, PIT-36.csv)
103. â³ Dodanie filtrÃ³w okresowych (rok podatkowy, kwartaÅ‚y) + zarzÄ…dzanie bÅ‚Ä™dami podatkowymi
104. â³ Implementacja dodatkowych eksportÃ³w (Cashflows.csv, etc.) + audit trail
105. â³ Testowanie poprawnoÅ›ci kalkulacji podatkowych + backup/restore narzÄ™dzia

**Status ETAP 7**: â³ **PLANOWANY** - Start po ukoÅ„czeniu ETAPU 6

---

## ğŸ“ˆ ETAP 8: DASHBOARD I FINALIZACJA (punkty 106-110) â³ PLANOWANY

### Punkty 106-110: Dashboard - KPI i finalizacja projektu â³
106. â³ Utworzenie pages/dashboard.py z zaawansowanÄ… strukturÄ… + integracja z yfinance
107. â³ Implementacja KPI (wartoÅ›Ä‡ portfela USD, wolna gotÃ³wka, P/L YTD, CC chains overview)
108. â³ Implementacja yield calculations (CC yield, dividend yield, chain performance)
109. â³ Implementacja systemu alertÃ³w (expiry, pokrycie, yieldy) + stats.py z yield analizami
110. â³ **FINALIZACJA**: Utworzenie pages/charts.py, usuniÄ™cie ALL deweloperskich info, dokumentacja koÅ„cowa

**Status ETAP 8**: â³ **PLANOWANY** - Finalizacja i release production-ready

---

## ğŸ¯ KRYTERIA AKCEPTACJI

### âœ… Must-have (MVP)
- [x] KaÅ¼da operacja ma utrwalony kurs NBP D-1 i kwoty PLN
- [x] FIFO sprzedaÅ¼y dziaÅ‚a i pokazuje rozbicie po LOT-ach  
- [x] Blokada sprzedaÅ¼y akcji pod otwartym CC
- [x] PeÅ‚ne operacje CC (sprzedaÅ¼, buyback, expiry) z P/L PLN
- [ ] **CC Chains analytics** - tracking strategii opcyjnych ğŸ†•
- [ ] Dashboard z equity (USD), yieldami i alertami
- [ ] Taxes z rozbiciami PIT-38/PIT-36 i eksportami CSV
- [x] Kursy NBP pobierane automatycznie z moÅ¼liwoÅ›ciÄ… korekty

### ğŸ¯ Nice-to-have (Future)
- [ ] Import danych z IBKR/Lynx
- [ ] Zaawansowane wykresy (Plotly) 
- [ ] Corporate actions handling
- [ ] Multi-account support
- [ ] Mobile-responsive UI
- [ ] **Chain strategy recommendations** (AI-powered) ğŸ†•

---

## ğŸ“Š PROGRESS TRACKING

**Aktualny stan: 70/110 punktÃ³w (64%)**

### Status per etap:
- âœ… **ETAP 1** (1-15): 15/15 = 100% âœ…
- âœ… **ETAP 2** (16-30): 15/15 = 100% âœ…  
- âœ… **ETAP 3** (31-50): 20/20 = 100% âœ…
- âœ… **ETAP 4** (51-70): 20/20 = 100% âœ… ğŸ‰
- ğŸ†• **ETAP 5** (71-85): 0/15 = 0% â³ CC CHAINS
- â³ **ETAP 6** (86-95): 0/10 = 0% â³ DIVIDENDS
- â³ **ETAP 7** (96-105): 0/10 = 0% â³ TAXES  
- â³ **ETAP 8** (106-110): 0/5 = 0% â³ DASHBOARD

### NajbliÅ¼sze milestone:
ğŸ¯ **PUNKT 71**: Start CC Chains - tabela w bazie danych
ğŸ¯ **PUNKT 85**: UkoÅ„czenie ETAPU 5 = 77% projektu!

---

## ğŸš€ PLAN REALIZACJI - NASTÄ˜PNE KROKI

### **Za 1 tydzieÅ„ (punkty 71-75):**
- ğŸ”— Struktura CC Chains w bazie
- ğŸ”— Auto-detection algorytm
- ğŸ”— Podstawowe UI chains

### **Za 2 tygodnie (punkty 76-85):**
- ğŸ“Š Chain analytics i kalkulacje
- ğŸ“ˆ Performance tracking
- **UKOÅƒCZENIE ETAPU 5 = 77% projektu!**

### **Za 4 tygodnie (punkty 86-95):**
- ğŸ’° PeÅ‚ny moduÅ‚ Dividends
- **UKOÅƒCZENIE ETAPU 6 = 86% projektu!**

### **Za 6 tygodni (punkty 96-105):**
- ğŸ“‹ PeÅ‚ny moduÅ‚ Taxes
- **UKOÅƒCZENIE ETAPU 7 = 95% projektu!**

### **Za 8 tygodni (punkty 106-110):**
- ğŸ“ˆ Dashboard, finalizacja
- **ğŸ† RELEASE PRODUCTION-READY = 100%!**

---

## ğŸ†• NOWE FUNKCJONALNOÅšCI - CC CHAINS

### **Co to jest CC Chain:**
**Chain (Å‚aÅ„cuch)** = grupa powiÄ…zanych CC na tym samym tickerze, gdzie kaÅ¼de kolejne CC jest wystawiane po zamkniÄ™ciu poprzedniego (buyback/expiry).

**PrzykÅ‚ad WOLF Chain:**
```
ğŸº WOLF Chain #1:
â”œâ”€â”€ CC #5: 25.11 â†’ 02.12 (buyback) = -$0.44
â”œâ”€â”€ CC #8: 02.12 â†’ 15.12 (expiry) = +$1.20  
â”œâ”€â”€ CC #12: 16.12 â†’ 03.01 (buyback) = +$0.30
â””â”€â”€ CC #15: 04.01 â†’ running...

ğŸ“Š Chain Stats:
ğŸ’° Total P/L: +$1.06
ğŸ“… Duration: 40 dni
ğŸ“ˆ Annualized: +23.4%
```

### **Chain Analytics:**
- ğŸ”— **Chain Linking** - automatyczne lub rÄ™czne grupowanie CC
- ğŸ“Š **Performance Metrics** - P/L, duration, success rate, annualized return
- ğŸ† **Chain Ranking** - najlepsze/najgorsze strategies  
- ğŸ“ˆ **Strategy Insights** - ktÃ³re strike levels dziaÅ‚ajÄ… najlepiej
- â° **Timing Analysis** - optymalne momenty buyback vs expiry

**To bÄ™dzie MEGA feature dla profesjonalnego trackingu strategii opcyjnych!** ğŸš€ğŸ”¥

---

**Ostatnia aktualizacja**: 2025-01-26  
**Przez**: Assistant Claude  
**Status**: ETAP 4 ukoÅ„czony! NastÄ™pny: CC CHAINS ğŸ”—  
**Nowe moduÅ‚y**: 9 zakÅ‚adek (dodano CC Chains)