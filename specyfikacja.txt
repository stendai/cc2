# SPECYFIKACJA KOMPLETNA: STREAMLIT COVERED CALL DASHBOARD
## ZarzÄ…dzanie portfelem opcji pokrytych z rozliczeniami podatkowymi PL

**Status: 61/100 punktÃ³w ukoÅ„czone (61%)**  
**Ostatnia aktualizacja: 2025-01-08**  
**Aktualny milestone: PUNKT 61 - Blokady sprzedaÅ¼y akcji pod CC**

---

## ğŸ¯ OGÃ“LNY OPIS PROJEKTU

### Kontekst biznesowy
- **Broker**: Lynx (IBKR)
- **Dane**: RÄ™czne wprowadzanie w Streamlit (brak importÃ³w)
- **Konto**: Jedno w USD
- **Rozliczenia**: KaÅ¼da operacja przeliczana na PLN wg kursu NBP D-1; kurs i kwota PLN utrwalone w bazie

### Rozliczenia podatkowe
- **PIT-38**: akcje, opcje CC, prowizje, odsetki od margin, odsetki od gotÃ³wki, stock lending
- **PIT-36**: dywidendy (15% WHT + 4% dopÅ‚ata)
- **Uwaga**: Przewalutowania walut na rachunku nie sÄ… ksiÄ™gowane do PIT

### ModuÅ‚y aplikacji (8 kart w Streamlit)
1. **Dashboard**: KPI, equity (USD, MTM), yieldy, alerty
2. **Stocks**: zakupy w LOT-ach, sprzedaÅ¼e FIFO, blokady pod CC
3. **Options (CC)**: sprzedaÅ¼, buyback, expiry, rolowanie, rezerwacje FIFO
4. **Dividends**: brutto USD â†’ PLN, WHT 15%, dopÅ‚ata 4%, netto
5. **Cashflows**: peÅ‚ny dziennik wszystkich przepÅ‚ywÃ³w pieniÄ™Å¼nych
6. **Taxes**: rozbicia PIT-38/PIT-36, eksporty CSV
7. **Stats**: yieldy CC/dividend, P/L per ticker i caÅ‚oÅ›ciowo
8. **Charts**: equity curve, cashflow, pie charts, histogramy P/L

---

## ğŸ—ï¸ ETAP 1: FUNDAMENT APLIKACJI (punkty 1-15) âœ… UKOÅƒCZONY

### Punkty 1-5: Struktura podstawowa âœ…
1. âœ… Utworzenie struktury katalogÃ³w (app.py, db.py, structure.py, utils/, pages/)
2. âœ… Inicjalizacja gÅ‚Ã³wnej aplikacji Streamlit z pustÄ… strukturÄ… nawigacji
3. âœ… Konfiguracja poÅ‚Ä…czenia z bazÄ… SQLite (portfolio.db)
4. âœ… Utworzenie podstawowego layout'u aplikacji z sidebar navigation
5. âœ… Testowanie uruchomienia aplikacji (streamlit run app.py)

### Punkty 6-10: Baza danych i modele âœ…
6. âœ… Implementacja tabeli fx_rates (struktura + podstawowe operacje CRUD)
7. âœ… Implementacja tabeli cashflows (struktura + podstawowe operacje CRUD) 
8. âœ… Implementacja tabeli lots (struktura + podstawowe operacje CRUD)
9. âœ… Implementacja tabeli stock_trades i stock_trade_splits
10. âœ… Implementacja pozostaÅ‚ych tabel (options_cc, dividends, market_prices)

### Punkty 11-15: Utilities podstawowe âœ…
11. âœ… Implementacja utils/formatting.py (formatowanie liczb, walut, dat)
12. âœ… Implementacja pobierania kursÃ³w NBP z obsÅ‚ugÄ… weekendÃ³w/Å›wiÄ…t
13. âœ… Implementacja cache'owania kursÃ³w NBP w bazie
14. âœ… Testowanie pobierania i zapisywania kursÃ³w NBP
15. âœ… Seed database - utworzenie testowych kursÃ³w NBP na ostatnie 30 dni

**Status ETAP 1**: âœ… **KOMPLETNY** - Fundament aplikacji gotowy

---

## ğŸ’¸ ETAP 2: MODUÅ CASHFLOWS (punkty 16-30) âœ… UKOÅƒCZONY

### Punkty 16-20: Cashflows - struktura i logika âœ…
16. âœ… Utworzenie pages/cashflows.py z podstawowÄ… strukturÄ…
17. âœ… Implementacja formularza dodawania cashflow (wpÅ‚aty/wypÅ‚aty)
18. âœ… Implementacja automatycznego pobierania kursu NBP D-1 w formularzu
19. âœ… Implementacja zapisu cashflow z utrwaleniem fx_rate i amount_pln
20. âœ… Testowanie dodawania wpÅ‚at/wypÅ‚at z rÃ³Å¼nymi datami (wÅ‚Ä…cznie z weekendami)

### Punkty 21-25: Cashflows - UI i funkcjonalnoÅ›ci âœ…
21. âœ… Implementacja tabeli wyÅ›wietlajÄ…cej wszystkie cashflows
22. âœ… Dodanie filtrÃ³w (typ operacji, zakres dat, kwoty)
23. âœ… Implementacja edycji i usuwania cashflows
24. âœ… Dodanie walidacji (ujemne wypÅ‚aty, dodatnie wpÅ‚aty)
25. âœ… Implementacja moÅ¼liwoÅ›ci rÄ™cznej korekty kursu przed zapisem

### Punkty 26-30: Cashflows - finalizacja âœ…
26. âœ… Dodanie kolumny z linkami do operacji ÅºrÃ³dÅ‚owych (ref_table, ref_id)
27. âœ… Implementacja eksportu do CSV
28. âœ… Dodanie statystyk cashflow (suma wpÅ‚at, wypÅ‚at, saldo)
29. âœ… Testowanie peÅ‚nej funkcjonalnoÅ›ci moduÅ‚u cashflows
30. âœ… Dokumentacja i refaktoryzacja kodu cashflows

**Status ETAP 2**: âœ… **KOMPLETNY** - ModuÅ‚ Cashflows z filtrami, edycjÄ…, eksportem CSV

---

## ğŸ“Š ETAP 3: MODUÅ STOCKS (punkty 31-50) âœ… UKOÅƒCZONY

### Punkty 31-35: Stocks - zakupy (LOT-y) âœ…
31. âœ… Utworzenie pages/stocks.py z podstawowÄ… strukturÄ…
32. âœ… Implementacja formularza dodawania LOT-a (ticker, quantity, price, date)
33. âœ… Automatyczne pobieranie kursu NBP D-1 i wyliczanie cost_pln
34. âœ… Implementacja zapisu LOT-a z prowizjami (broker_fee, reg_fee)
35. âœ… Dodanie automatycznego tworzenia cashflow przy zakupie akcji

### Punkty 36-40: Stocks - logika FIFO âœ…
36. âœ… Implementacja algorytmu FIFO (sortowanie po buy_date, potem po id)
37. âœ… Implementacja funkcji sprawdzajÄ…cej dostÄ™pne quantity_open dla tickera
38. âœ… Implementacja podglÄ…du alokacji FIFO przed sprzedaÅ¼Ä…
39. âœ… Testowanie FIFO na rÃ³Å¼nych scenariuszach (czÄ™Å›ciowe sprzedaÅ¼e, rÃ³Å¼ne daty)
40. âœ… Implementacja walidacji - nie moÅ¼na sprzedaÄ‡ wiÄ™cej niÅ¼ quantity_open

### Punkty 41-45: Stocks - sprzedaÅ¼e âœ…
41. âœ… Implementacja formularza sprzedaÅ¼y akcji
42. âœ… Automatyczne rozbijanie sprzedaÅ¼y na LOT-y wedÅ‚ug FIFO
43. âœ… Proporcjonalne dzielenie prowizji sprzedaÅ¼owej na LOT-y
44. âœ… Kalkulacja P/L per LOT i caÅ‚oÅ›ciowy P/L sprzedaÅ¼y
45. âœ… Implementacja zapisu stock_trades i stock_trade_splits

### Punkty 46-50: Stocks - UI i finalizacja âœ…
46. âœ… Implementacja tabeli LOT-Ã³w (quantity_open, koszt PLN, kurs, daty)
47. âœ… Implementacja tabeli sprzedaÅ¼y z rozbiciami po LOT-ach
48. âœ… Dodanie filtrÃ³w i sortowania w tabelach
49. âœ… Implementacja eksportu stocks do CSV
50. âœ… Testowanie peÅ‚nej funkcjonalnoÅ›ci moduÅ‚u stocks

**Status ETAP 3**: âœ… **KOMPLETNY** - ModuÅ‚ Stocks z LOT-ami, FIFO, tabelami, eksportami

---

## ğŸ¯ ETAP 4: MODUÅ OPTIONS - COVERED CALLS (punkty 51-70) ğŸ”„ W TRAKCIE

### Punkty 51-55: Options - struktura i rezerwacje âœ…
51. âœ… Utworzenie pages/options.py z podstawowÄ… strukturÄ…
52. âœ… Implementacja logiki rezerwacji akcji FIFO dla CC
53. âœ… Implementacja sprawdzania dostÄ™pnoÅ›ci pokrycia przed zapisem CC
54. âœ… Implementacja formularza sprzedaÅ¼y CC (ticker, contracts, strike, premium, expiry)
55. âœ… Implementacja zapisu options_cc z rezerwacjÄ… quantity_open w lots

### Punkty 56-60: Options - operacje CC âœ…
56. âœ… Implementacja automatycznego tworzenia cashflow przy sprzedaÅ¼y CC
57. âœ… Implementacja formularza buyback CC
58. âœ… Implementacja oznaczania CC jako expired (close_date = expiry_date)
59. âœ… Kalkulacja P/L dla bought_back i expired CC w PLN
60. âœ… Implementacja zwalniania rezerwacji akcji przy zamkniÄ™ciu CC

### Punkty 61-65: Options - blokady i walidacje ğŸ”¥
61. âœ… **UKOÅƒCZONY** - Implementacja blokady sprzedaÅ¼y akcji pod otwartymi CC
62. â³ Rozszerzenie walidacji w UI stocks z szczegÃ³Å‚owymi komunikatami
63. â³ Dodanie przyciskÃ³w usuwania bÅ‚Ä™dnych CC (z automatycznym zwalnianiem rezerwacji)
64. â³ Implementacja edycji parametrÃ³w CC + usuwania rekordÃ³w testowych
65. â³ Implementacja funkcji Roll jako dwie operacje (buyback + nowa sprzedaÅ¼)

### Punkty 66-70: Options - UI i finalizacja â³
66. â³ Implementacja zaawansowanych tabel otwartych CC z rozbiciami po LOT-ach
67. â³ Implementacja tabel zamkniÄ™tych CC z P/L PLN i kursami open/close + **CLEANUP UI**
68. â³ Dodanie filtrÃ³w zaawansowanych (status, ticker, zakresy dat) + **USUWANIE INFO DEWELOPERSKICH**
69. â³ Implementacja eksportu options do CSV + **NARZÄ˜DZIA CLEANUP**
70. â³ Testowanie peÅ‚nej funkcjonalnoÅ›ci moduÅ‚u options + **FINALIZACJA PROFESJONALNEGO UI**

**Status ETAP 4**: ğŸ”„ **61/70 ukoÅ„czone (87%)** - Options z blokadami CC dziaÅ‚ajÄ…!

---

## ğŸ’° ETAP 5: MODUÅ DIVIDENDS (punkty 71-80) â³ PLANOWANY

### Punkty 71-75: Dividends - logika podstawowa
71. Utworzenie pages/dividends.py z podstawowÄ… strukturÄ…
72. Implementacja formularza dywidend (ticker, gross_usd, date_paid)
73. Automatyczne wyliczanie WHT 15% i dopÅ‚aty 4%
74. Implementacja zapisu dividends z wszystkimi polami PLN
75. Automatyczne tworzenie cashflow typu 'dividend'

### Punkty 76-80: Dividends - UI i finalizacja
76. Implementacja tabeli dywidend z rozbiciami (brutto, WHT, dopÅ‚ata, netto)
77. Dodanie filtrÃ³w i sortowania + **przyciski edycji/usuwania dywidend**
78. Implementacja eksportu dividends do CSV
79. Integracja z moduÅ‚em taxes (kategoria PIT-36)
80. Testowanie peÅ‚nej funkcjonalnoÅ›ci moduÅ‚u dividends + **cleanup bÅ‚Ä™dnych rekordÃ³w**

**Status ETAP 5**: â³ **PLANOWANY** - Start po ukoÅ„czeniu ETAPU 4

---

## ğŸ“‹ ETAP 6: MODUÅ TAXES - ROZLICZENIA PODATKOWE (punkty 81-90) â³ PLANOWANY

### Punkty 81-85: Taxes - logika PIT
81. Utworzenie pages/taxes.py i utils/tax.py
82. Implementacja logiki PIT-38 (przychody i koszty)
83. Implementacja logiki PIT-36 (dywidendy z rozbiciami)
84. Implementacja agregacji danych z wszystkich moduÅ‚Ã³w
85. Kalkulacja sum dla PIT-38 (razem przychody/koszty) i PIT-36 + **narzÄ™dzia administracyjne**

### Punkty 86-90: Taxes - raporty i eksporty
86. Implementacja szczegÃ³Å‚owych tabel rozbiÄ‡ PIT-38/PIT-36 + **batch operations**
87. Implementacja eksportÃ³w CSV (PIT-38.csv, PIT-36.csv)
88. Dodanie filtrÃ³w okresowych (rok podatkowy, kwartaÅ‚y) + **zarzÄ…dzanie bÅ‚Ä™dami podatkowymi**
89. Implementacja dodatkowych eksportÃ³w (Cashflows.csv, etc.) + **audit trail**
90. Testowanie poprawnoÅ›ci kalkulacji podatkowych + **backup/restore narzÄ™dzia**

**Status ETAP 6**: â³ **PLANOWANY** - Start po ukoÅ„czeniu ETAPU 5

---

## ğŸ“ˆ ETAP 7: DASHBOARD I FINALIZACJA (punkty 91-100) â³ PLANOWANY

### Punkty 91-95: Dashboard - KPI i alerty
91. Utworzenie pages/dashboard.py z zaawansowanÄ… strukturÄ…
92. Integracja z yfinance dla cen akcji (cache w market_prices)
93. Implementacja KPI (wartoÅ›Ä‡ portfela USD, wolna gotÃ³wka, P/L YTD)
94. Implementacja yield calculations (CC yield, dividend yield)
95. Implementacja systemu alertÃ³w (expiry, pokrycie, yieldy) + **stats.py z yield analizami**

### Punkty 96-100: Finalizacja projektu
96. Utworzenie pages/charts.py - wykresy equity curve, cashflow, pie charts
97. Implementacja histogramÃ³w P/L i zaawansowanych wizualizacji
98. **Przeprowadzenie peÅ‚nych testÃ³w end-to-end** + **usuniÄ™cie WSZYSTKICH info deweloperskich**
99. **Optymalizacja performance i finalne poprawki UI/UX** + **profesjonalizacja interfejsu**
100. **Dokumentacja koÅ„cowa i instrukcja obsÅ‚ugi** + **release production-ready**

**Status ETAP 7**: â³ **PLANOWANY** - Finalizacja i release

---

## ğŸ—‘ï¸ NOWE FUNKCJONALNOÅšCI - ZARZÄ„DZANIE DANYMI

### **Dodane do specyfikacji w trakcie realizacji:**

#### **PUNKT 63-64: ZarzÄ…dzanie bÅ‚Ä™dami (ETAP 4)**
- ğŸ—‘ï¸ **Usuwanie bÅ‚Ä™dnych operacji** w kaÅ¼dym module (CC, stocks, cashflows, dividends)
- ğŸ”„ **Edycja parametrÃ³w** przed zapisem
- âš ï¸ **Potwierdzenia bezpieczeÅ„stwa** przed usuniÄ™ciem
- ğŸ§¹ **Cleanup rekordÃ³w testowych** (bulk operations)
- ğŸ”’ **Zabezpieczenia** przed przypadkowym usuniÄ™ciem

#### **PUNKT 67-68: Oczyszczanie UI (ETAP 4)**
- ğŸš« **UsuniÄ™cie komunikatÃ³w "PUNKT X UKOÅƒCZONY"** z wszystkich moduÅ‚Ã³w
- ğŸš« **UsuniÄ™cie testowych buttonÃ³w** i debug info
- ğŸš« **UsuniÄ™cie szczegÃ³Å‚Ã³w implementacyjnych** z UI
- âœ¨ **Profesjonalne komunikaty** zamiast deweloperskich
- ğŸ“± **Responsive design** dla rÃ³Å¼nych urzÄ…dzeÅ„

#### **PUNKT 85-86: Zaawansowane zarzÄ…dzanie (ETAP 6)**
- ğŸ—„ï¸ **Backup/restore** bazy danych
- ğŸ§¹ **Cleanup narzÄ™dzia** (usuwanie starych danych)
- ğŸ” **Audit trail** (kto, kiedy, co usunÄ…Å‚)
- ğŸ“¦ **Bulk operations** (masowe usuwanie/edytowanie)
- ğŸšš **Export/import** danych

#### **PUNKT 98-99: Finalna profesjonalizacja (ETAP 7)**
- ğŸ¨ **UsuniÄ™cie WSZYSTKICH** pozostaÅ‚oÅ›ci deweloperskich
- âœ¨ **Finalne UI/UX** na poziomie produkcyjnym
- ğŸ“‹ **Instrukcje uÅ¼ytkownika** zamiast dokumentacji technicznej
- ğŸ† **Production-ready release**

---

## ğŸ¯ KRYTERIA AKCEPTACJI

### âœ… Must-have (MVP)
- [x] KaÅ¼da operacja ma utrwalony kurs NBP D-1 i kwoty PLN
- [x] FIFO sprzedaÅ¼y dziaÅ‚a i pokazuje rozbicie po LOT-ach  
- [x] Blokada sprzedaÅ¼y akcji pod otwartym CC
- [ ] Rolowanie jako dwie osobne operacje
- [ ] Dashboard z equity (USD), yieldami i alertami
- [ ] Taxes z rozbiciami PIT-38/PIT-36 i eksportami CSV
- [x] Kursy NBP pobierane automatycznie z moÅ¼liwoÅ›ciÄ… korekty

### ğŸ¯ Nice-to-have (Future)
- [ ] Import danych z IBKR/Lynx
- [ ] Zaawansowane wykresy (Plotly)
- [ ] Corporate actions handling
- [ ] Multi-account support
- [ ] Mobile-responsive UI

---

## ğŸ“Š PROGRESS TRACKING

**Aktualny stan: 61/100 punktÃ³w (61%)**

### Status per etap:
- âœ… **ETAP 1** (1-15): 15/15 = 100% âœ…
- âœ… **ETAP 2** (16-30): 15/15 = 100% âœ…  
- âœ… **ETAP 3** (31-50): 20/20 = 100% âœ…
- ğŸ”¥ **ETAP 4** (51-70): 11/20 = 55% ğŸ”„
- â³ **ETAP 5** (71-80): 0/10 = 0% â³
- â³ **ETAP 6** (81-90): 0/10 = 0% â³
- â³ **ETAP 7** (91-100): 0/10 = 0% â³

### NajbliÅ¼sze milestone:
ğŸ¯ **PUNKT 62**: Rozszerzenie walidacji blokad CC
ğŸ¯ **PUNKT 70**: UkoÅ„czenie ETAPU 4 = 70% projektu!

---

## ğŸš€ PLAN REALIZACJI - NASTÄ˜PNE KROKI

### **Za 1 tydzieÅ„ (punkty 62-65):**
- Finalizacja blokad CC
- Dodanie funkcji usuwania bÅ‚Ä™dnych operacji
- Edycja parametrÃ³w CC

### **Za 2 tygodnie (punkty 66-70):**
- Oczyszczanie UI z info deweloperskich
- Zaawansowane tabele i filtry
- **UKOÅƒCZENIE ETAPU 4 = 70% projektu!**

### **Za 4 tygodnie (punkty 71-80):**
- PeÅ‚ny moduÅ‚ Dividends
- **UKOÅƒCZENIE ETAPU 5 = 80% projektu!**

### **Za 6 tygodni (punkty 81-90):**
- PeÅ‚ny moduÅ‚ Taxes
- **UKOÅƒCZENIE ETAPU 6 = 90% projektu!**

### **Za 8 tygodni (punkty 91-100):**
- Dashboard, Charts, finalizacja
- **ğŸ† RELEASE PRODUCTION-READY = 100%!**

---

**Ostatnia aktualizacja**: 2025-01-08  
**Przez**: Assistant Claude  
**Status**: PUNKT 61 ukoÅ„czony - Blokady CC dziaÅ‚ajÄ…!  
**NastÄ™pny milestone**: PUNKT 62-70 - Finalizacja ETAPU 4